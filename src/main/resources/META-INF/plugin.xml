<idea-plugin>
    <id>com.bogdanbujor.azure-templates-navigator</id>
    <name>Azure Templates Navigator</name>
    <vendor email="bogdan@bogdanbujor.com" url="https://github.com/qSharpy">bogdanbujor</vendor>
    <description><![CDATA[
        <p><b>Azure Templates Navigator</b> supercharges your Azure DevOps pipeline development in IntelliJ-based IDEs.</p>

        <p>Working with Azure Pipelines templates across multiple repositories? This plugin gives you full IDE support
        for template references — hover documentation, go-to-declaration, autocompletion, and real-time validation.</p>

        <h3>Features</h3>
        <ul>
            <li><b>Hover Documentation</b> — hover over any template reference to see its parameters, types, and default values</li>
            <li><b>Go-to-Declaration</b> — Ctrl+Click (or Cmd+Click) on a template path to jump directly to the template file</li>
            <li><b>Parameter Autocompletion</b> — get intelligent suggestions for template parameters as you type</li>
            <li><b>Parameter Validation</b> — real-time inspections flag missing required parameters and unknown parameter names</li>
            <li><b>Variable Hover</b> — hover over pipeline variables to see their values</li>
            <li><b>Dependency Tree</b> — visualize the full template dependency hierarchy in a dedicated tool window</li>
            <li><b>Interactive Graph</b> — explore template relationships with an interactive D3.js-powered graph visualization</li>
            <li><b>Diagnostics Panel</b> — see all template issues across your project in one place</li>
            <li><b>Cross-Repository Support</b> — resolves templates from sibling repositories on disk</li>
        </ul>

        <h3>Supported File Types</h3>
        <p>YAML files containing Azure Pipelines definitions (azure-pipelines.yml, templates, stages, jobs, etc.)</p>
    ]]></description>

    <change-notes><![CDATA[
        <h3>1.6.0</h3>
        <ul>
            <li><b>Errors Only filter in Dependency Tree</b> — new toolbar button hides all non-error nodes from the tree entirely; only files with ERROR-level diagnostics are shown, making it instant to spot every broken template at a glance</li>
            <li><b>Deep error surfacing</b> — when Errors Only is active, errors nested deep in the dependency chain are promoted to the nearest visible ancestor so no error is ever hidden</li>
            <li><b>Hide Warnings renamed</b> — the previous "Errors Only" toggle (which only suppressed amber colouring) is now correctly labelled "Hide Warnings" to distinguish it from the new structural filter</li>
            <li><b>Empty group nodes suppressed</b> — "Called by" and "Is calling" section headers are omitted when all their children are filtered out, keeping the tree clean</li>
        </ul>
        <h3>1.5.0</h3>
        <ul>
            <li><b>Searchable parameter popup</b> — hovering over a template reference now opens a dedicated Swing popup (instead of a plain HTML tooltip) with a live search field; type to instantly filter parameters by name</li>
            <li><b>Keyboard navigation in popup</b> — use ↓/↑ arrow keys from the search field to move through the parameter list; press Enter (or double-click) to jump directly to the parameter declaration in the template file</li>
            <li><b>Go-to-parameter-declaration</b> — selecting a parameter in the hover popup and pressing Enter or double-clicking opens the template file at the exact line where that parameter is declared</li>
            <li><b>Removed absolute file path from hover</b> — the tooltip previously showed both the relative template path and the absolute file path; now only the relative path is shown</li>
            <li><b>Proper HTML styling in popup</b> — required parameters render in bold + configured colour, optional parameters in bold, types in code style, defaults and (required) badges all styled correctly</li>
        </ul>
        <h3>1.4.0</h3>
        <ul>
            <li><b>Fuzzy search in Dependency Tree</b> — new search bar at the top of the Dependencies panel lets you find any indexed template by typing; results appear in a popup with filename (bold) and directory path (grey), navigable with Up/Down/Enter/Escape</li>
            <li><b>Typo-tolerant matching</b> — the underlying <code>FuzzySearch</code> engine combines subsequence scoring, word-boundary bonuses, camel-case bonuses, and Levenshtein-based segment fuzzy matching so queries like "templete" still find "template"</li>
            <li><b>Debounced search input</b> — search fires 150 ms after the last keystroke to avoid redundant work on fast typing</li>
            <li><b>Configurable graph depth</b> — the Graph tool window now shows −/+ depth controls in the toolbar; in file-scope mode you can expand or narrow how many upstream/downstream levels are rendered (1–10)</li>
            <li><b>Multi-level BFS in file graph</b> — <code>GraphBuilder.buildFileGraph()</code> now performs a proper breadth-first traversal for both downstream templates and upstream callers up to the configured depth, instead of always stopping at depth 1</li>
        </ul>
        <h3>1.3.0</h3>
        <ul>
            <li><b>Severity indicators in Dependency Tree</b> — tree nodes are coloured red/amber and suffixed with ✖/⚠ based on their worst diagnostic severity, so issues are visible without opening the Diagnostics panel</li>
            <li><b>File header severity badge</b> — the header label in the Dependency Tree panel shows an error/warning icon and coloured filename for the currently active file</li>
            <li><b>Hide Warnings toggle</b> — new toolbar action suppresses amber warning highlights in the tree so only errors are shown in colour</li>
            <li><b>Open in Diagnostics action</b> — toolbar button jumps from the Dependency Tree panel directly to the matching file node in the Diagnostics tool window</li>
            <li><b>Copy Path action</b> — copies the workspace-relative path of the active file to the clipboard with a brief checkmark icon feedback</li>
            <li><b>Diagnostics cache in index service</b> — <code>TemplateIndexService</code> now maintains a per-file worst-severity cache (<code>getFileSeverity()</code>) rebuilt on every index update, eliminating redundant re-validation in the UI layer</li>
            <li><b>Diagnostics panel: programmatic file selection</b> — new <code>selectFile()</code> API scrolls and expands the matching file node in the Diagnostics tree</li>
        </ul>
        <h3>1.2.0</h3>
        <ul>
            <li><b>Unused Parameter diagnostic</b> — new template-side inspection detects parameters declared in <code>parameters:</code> that are never referenced via <code>${{ parameters.name }}</code> in the template body; reported as a Warning with a one-click "Remove unused parameter declaration" quick-fix</li>
            <li><b>Diagnostics panel integration</b> — the Diagnostics tool window now surfaces unused-parameter warnings project-wide alongside caller-side errors, so dead parameters are visible without opening each file</li>
            <li><b>Precise highlight range</b> — the unused-parameter squiggly now covers only the parameter name token, not the leading whitespace on the declaration line</li>
        </ul>
        <h3>1.1.0</h3>
        <ul>
            <li><b>Quick-fix actions</b> — one-click fixes for missing required parameters, unknown parameters, and type mismatches directly in the editor</li>
            <li><b>Performance improvements</b> — background indexing prevents IDE freezes on large workspaces; VFS-based file reads replace blocking I/O</li>
            <li><b>Full path toggle</b> — switch between short and full file paths in the Dependency Tree and Graph tool windows</li>
            <li><b>Graph enhancements</b> — zoom controls, improved force-directed layout, and a legend for node types</li>
            <li><b>Improved documentation styling</b> — richer hover tooltips with better HTML formatting</li>
            <li><b>Better template resolution</b> — more robust go-to-declaration for cross-repo and relative template paths</li>
            <li><b>Robustness fixes</b> — regex constants extracted to companion objects, mutable data class fields eliminated, flexible indent detection in parameter parser</li>
        </ul>
        <h3>1.0.0</h3>
        <ul>
            <li>Initial release</li>
            <li>Template parameter hover documentation</li>
            <li>Go-to-declaration for template references</li>
            <li>Parameter autocompletion with type information</li>
            <li>Real-time template parameter validation inspections</li>
            <li>Gutter icons for template references</li>
            <li>Dependency tree tool window</li>
            <li>Interactive D3.js template graph visualization</li>
            <li>Diagnostics tool window for project-wide template issues</li>
            <li>Cross-repository template resolution</li>
            <li>Configurable sibling repository paths</li>
        </ul>
    ]]></change-notes>

    <depends>com.intellij.modules.platform</depends>
    <depends>org.jetbrains.plugins.yaml</depends>

    <extensions defaultExtensionNs="com.intellij">
        <!-- Documentation (hover) -->
        <lang.documentationProvider language="yaml"
            implementationClass="com.bogdanbujor.azuretemplates.providers.TemplateDocumentationProvider"/>

        <!-- Searchable parameter popup on hover (Swing-based, replaces JS search) -->
        <editorFactoryListener
            implementation="com.bogdanbujor.azuretemplates.providers.TemplateEditorFactoryListener"/>

        <!-- Go-to-declaration -->
        <gotoDeclarationHandler
            implementation="com.bogdanbujor.azuretemplates.providers.TemplateGotoDeclarationHandler"/>

        <!-- Completion -->
        <completion.contributor language="yaml"
            implementationClass="com.bogdanbujor.azuretemplates.providers.TemplateCompletionContributor"/>

        <!-- Inspection: caller-side parameter validation -->
        <localInspection language="yaml"
            groupName="Azure Templates Navigator"
            displayName="Template parameter validation"
            enabledByDefault="true"
            level="ERROR"
            implementationClass="com.bogdanbujor.azuretemplates.providers.TemplateInspection"/>

        <!-- Inspection: template-side unused parameter detection -->
        <localInspection language="yaml"
            groupName="Azure Templates Navigator"
            displayName="Unused template parameter declaration"
            shortName="AzureTemplatesUnusedParameter"
            enabledByDefault="true"
            level="WARNING"
            implementationClass="com.bogdanbujor.azuretemplates.providers.UnusedParameterInspection"/>

        <!-- Line markers (gutter icons) -->
        <codeInsight.lineMarkerProvider language="yaml"
            implementationClass="com.bogdanbujor.azuretemplates.providers.TemplateLineMarkerProvider"/>

        <!-- Tool windows -->
        <toolWindow id="Azure Templates - Dependencies"
            anchor="right"
            factoryClass="com.bogdanbujor.azuretemplates.ui.DependencyTreeToolWindow"
            icon="AllIcons.Nodes.TreeOpen"/>

        <toolWindow id="Azure Templates - Graph"
            anchor="right"
            factoryClass="com.bogdanbujor.azuretemplates.ui.GraphToolWindow"
            icon="AllIcons.Nodes.DataTables"/>

        <toolWindow id="Azure Templates - Diagnostics"
            anchor="bottom"
            factoryClass="com.bogdanbujor.azuretemplates.ui.DiagnosticsToolWindow"
            icon="AllIcons.General.InspectionsEye"/>

        <!-- Settings -->
        <applicationConfigurable
            parentId="tools"
            instance="com.bogdanbujor.azuretemplates.settings.PluginSettingsConfigurable"
            id="com.bogdanbujor.azuretemplates.settings"
            displayName="Azure Templates Navigator"/>

        <applicationService
            serviceImplementation="com.bogdanbujor.azuretemplates.settings.PluginSettings"/>

        <!-- Project service -->
        <projectService
            serviceImplementation="com.bogdanbujor.azuretemplates.services.TemplateIndexService"/>
    </extensions>

    <actions>
        <group id="AzureTemplatesNavigator.ToolbarActions" text="Azure Templates Navigator">
            <action id="AzureTemplatesNavigator.RefreshTree"
                class="com.bogdanbujor.azuretemplates.actions.RefreshTreeAction"
                text="Refresh Template Tree"
                icon="AllIcons.Actions.Refresh"/>
            <action id="AzureTemplatesNavigator.RefreshGraph"
                class="com.bogdanbujor.azuretemplates.actions.RefreshGraphAction"
                text="Refresh Template Graph"
                icon="AllIcons.Actions.Refresh"/>
            <action id="AzureTemplatesNavigator.RefreshDiagnostics"
                class="com.bogdanbujor.azuretemplates.actions.RefreshDiagnosticsAction"
                text="Refresh Diagnostics"
                icon="AllIcons.Actions.Refresh"/>
        </group>
    </actions>
</idea-plugin>
